---
title: JAVA解惑-多重转型
date: 2018-10-10 23:09:53
tags: 
- java
categories: 
- java基础知识
---

JAVA解惑-多重转型
<!-- more -->

## 多重转型问题

转型被用来将一个数值从一个类型转换到另外一个类型.下面的程序连续使用三个转型,它的输出是什么?

```java
public static void main(String[] args){
    // 输出 65535
    System.out.println((int)(char)(byte)-1);
}
```

为什么?该程序的行为紧密依赖于转型的符号扩展行为.
有一条简单的规则能够描述从较窄的整型转换成较宽的整型时符号扩展行为:**如果最初的数值类型是有符号的,那么就执行符号扩展;如果它是 char, 那么不管它将要转换成什么类型,都执行零扩展.**

首先-1是 int 类型,从 int 到 byte 的转换是简单的,它执行了一个窄化原始类型转化,直接将除低8位之外的所有位全部砍掉,这样做留下的是一个8位的byte,它仍旧表示-1.因为 byte 是一个有符号的类型,所以在将byte 转换为 char 时(2个字节16位),会发生符号扩展,变成了2^16 - 1 (65535). 从char 到 int 的转型是一个扩宽原始类型的转换,它将执行零扩展而不是符号扩展,所以结果的int 数值变成了65535.

## 解决方案

如果在将一个 char 数值 c 转型为一个宽度更宽的整型,并且希望是有符号扩展,那么先将 char类型转型为一个 short, 它与 char 具有同样的宽度,但它是有符号的.

```java
// 转型将引起符号扩展
int i = (short) c;
```

如果将一个 byte 数值 b 转型为一个 char, 并且不希望有符号扩展,那么必须使用一个位掩码来限制它.这是一种通用的做法,可以不需要注释.

```java
// 无符号扩展
char c = (char) (b & 0xff);
```
